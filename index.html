<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Scanner</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5-qrcode/2.3.4/html5-qrcode.min.js" integrity="sha512-k/KAe4Yff9EUdYI5/IAHlwUswqeipP+Cp5qnrsUjTPCgl51La2/JhyyjNciztD7mWNKLSXci48m7cctATKfLlQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <style>
        main {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        #reader {
            width: 600px;
        }
        #result {
            text-align: center;
            font-size: 1.5rem;
        }
        .product-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .product-details {
            margin-right: 10px;
        }
        .cancel-button {
            margin-left: auto;
        }
        #button {
           background-color: #28f833;
           color: #ffffff;
           border: none;
           padding: 5px 10px;
           cursor: pointer;
           margin-left: 10px;
           text-align: center;
           
        }
    </style>
</head> 
<body>
    <h1 style="color: red; text-align: center;">HF SMART CART</h1>
    <h3 style="text-align: center;">QR Scanner</h3>
    <p style="text-align: center;" >Show the product QR code in front of the camera</p>

    <main>
        <div id="reader"></div>
        <div id="result"></div>
    </main>

    <div id="product-list"><h3 style="text-align: center; padding-top: 3px;">Product details</h3></div>
    <div id="total-sum"></div>

    <script>
        const productList = document.getElementById('product-list');
        const totalSumElement = document.getElementById('total-sum');
        const productDetails = [];

        const scanner = new Html5QrcodeScanner('reader', { 
            qrbox: {
                width: 250,
                height: 250,
            },
            fps: 1,
        });

        scanner.render(handleQRScan, handleError);

        function handleQRScan(qrCodeData) {
            const listItem = document.createElement('div');
            listItem.className = 'product-item';

            const productInfo = qrCodeData.split(" - ");
            const productName = productInfo[0];
            const productPrice = parseFloat(productInfo[1]);

            const productDetailsElement = document.createElement('div');
            productDetailsElement.className = 'product-details';
            productDetailsElement.textContent = `${productName} - ₹${productPrice}`;

            const cancelButton = document.createElement('button');
            cancelButton.textContent = 'Cancel';
            cancelButton.addEventListener('click', function() {
                listItem.remove();
                const index = productDetails.indexOf(qrCodeData);
                if (index > -1) {
                    productDetails.splice(index, 1);
                }
                updateTotalSum();
            });

            listItem.appendChild(productDetailsElement);
            listItem.appendChild(cancelButton);
            productList.appendChild(listItem);

            productDetails.push(qrCodeData);
            updateTotalSum();
        }

        function updateTotalSum() {
            let totalSum = 0;
            productDetails.forEach(qrCodeData => {
                const productPrice = parseFloat(qrCodeData.split(" - ")[1]);
                totalSum += productPrice;
            });

            totalSumElement.textContent = `Total: ₹${totalSum}`;
        }

        function handleError(error) {
            console.error(error);
        }
    </script>
    <button id="button">Pay</button>
</body>
</html>
